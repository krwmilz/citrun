SubDir TOP bin ;
SubDirHdrs $(TOP) lib ;

#
# citrun_report
#
SHELLHEADER on citrun_report = "#!/usr/bin/awk -f" ;
MakeLocate citrun_report : bin ;
Shell citrun_report : report.awk ;

#
# citrun_wrap
#
SHELLHEADER on citrun_wrap = "#!/bin/sh" ;
MakeLocate citrun_wrap : bin ;
Shell citrun_wrap : wrap.sh ;
ReplacePrefix citrun_wrap ;

#
# citrun_inst
#
INST_SRCS =
	inst_main.cc
	inst_fe.cc
	inst_feunix.cc
	inst_action.cc
	inst_visitor.cc ;

ObjectC++Flags $(INST_SRCS) : `llvm-config --cppflags` -DPREFIX=\\\"$(PREFIX)\\\" ;

LINKFLAGS on citrun_inst = $(LINKFLAGS) ;
LINKLIBS on citrun_inst +=
	`llvm-config --ldflags`
	$(INST_EXTRALIB)
	-lclangTooling
	-lclangFrontendTool
	-lclangFrontend
	-lclangDriver
	-lclangSerialization
	-lclangCodeGen
	-lclangParse
	-lclangSema
	-lclangAnalysis
	-lclangRewrite
	-lclangRewriteFrontend
	-lclangEdit
	-lclangAST
	-lclangLex
	-lclangBasic
	`llvm-config --system-libs --libs bitreader mcparser transformutils option`
	;

Main citrun_inst : $(INST_SRCS) ;

#
# citrun_gl,  citrun_gltest
#
GL_SRCS =
	gl_atlas.cc
	gl_buffer.cc
	gl_font.cc
	gl_main.cc
	gl_runtime.cc
	gl_shader.cc
	gl_state.cc
	gl_view.cc
	matrix4x4.c ;

Library gl_common : $(GL_SRCS) ;

Stringize demo_atlas_glsl.h :   demo_atlas.glsl ;
Stringize demo_vshader_glsl.h : demo_vshader.glsl ;
Stringize demo_fshader_glsl.h : demo_fshader.glsl ;

ObjectC++Flags gl.cc gltest.cc $(GL_SRCS) : `pkg-config --cflags glfw3 glew freetype2` ;

LINKLIBS on citrun_gl += -lm $(GL_EXTRALIB) `pkg-config --libs glfw3 glew freetype2` ;
LINKLIBS on citrun_gltest += -lm `pkg-config --libs glfw3 osmesa freetype2` ;
LINKLIBS on citrun_gltest += bin/glew-2.1.0/lib/libGLEW.a ;

LinkLibraries citrun_gl citrun_gltest : gl_common libglyphy ;

Main citrun_gl : gl.cc ;
Main citrun_gltest : gltest.cc ;

# Link with the c++ compiler so that the matching c++ runtime library gets added
# automatically.
LINK on citrun_inst citrun_gl citrun_gltest = $(C++) ;

#
# install
#
InstallShell	$(PREFIX)/bin		: citrun_report citrun_wrap ;
InstallBin	$(PREFIX)/bin		: citrun_gl citrun_inst ;

SubInclude TOP bin glyphy ;
