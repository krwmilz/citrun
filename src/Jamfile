SubDir TOP src ;

#
# citrun-wrap
#
MkWrap citrun-wrap : wrap.in ;
InstallShell $(PREFIX)/bin : citrun-wrap ;

#
# utils.a
#
ObjectC++Flags af_unix.cc runtime_conn.cc : -std=c++11 ;
Library utils : af_unix.cc runtime_conn.cc ;

#
# citrun-term
#
ObjectC++Flags term_main.cc : -std=c++11 ;
LINKLIBS on citrun-term += -lcurses -L/usr/local/lib -lestdc++ ;

LinkLibraries citrun-term : utils ;
Main citrun-term : term_main.cc ;

#
# citrun-gl
#
GL_SRCS =
	gl_main.cc
	gl_view.cc
	demo-atlas.cc
	gl_buffer.cc
	demo-font.cc
	demo-glstate.cc
	demo-shader.cc
	matrix4x4.c
	trackball.c ;

Stringize demo_atlas_glsl.h :   demo_atlas.glsl ;
Stringize demo_vshader_glsl.h : demo_vshader.glsl ;
Stringize demo_fshader_glsl.h : demo_fshader.glsl ;

ObjectC++Flags $(GL_SRCS) : -std=c++11 ;
ObjectC++Flags $(GL_SRCS) : `pkg-config $(PKG_CONFIG_LIBS) --cflags` ;

LINKLIBS on citrun-gl += `pkg-config $(PKG_CONFIG_LIBS) --libs` ;
LinkLibraries citrun-gl : libglyphy utils ;

Main citrun-gl : $(GL_SRCS) ;
InstallBin $(PREFIX)/bin : citrun-gl ;

#
# citrun-inst
#
INST_SRCS =
	inst_main.cc
	inst_action.cc
	inst_ast_visitor.cc ;

Stringize runtime_h.h : $(TOP)/lib/runtime.h ;

ObjectC++Flags $(INST_SRCS) : `llvm-config --cxxflags` ;
ObjectC++Flags $(INST_SRCS) : -DCITRUN_LIB=$(CITRUN_LIB) -DCITRUN_PATH=$(CITRUN_PATH) ;
ObjectC++Flags $(INST_SRCS) : -DLLVM_VER=$(LLVM_VER) ;

LINKFLAGS on citrun-inst = `llvm-config --ldflags` ;

CLANG_LIBS =
	-Wl,--start-group
	-lclangAST
	-lclangAnalysis
	-lclangBasic
	-lclangDriver
	-lclangEdit
	-lclangFrontend
	-lclangFrontendTool
	-lclangLex
	-lclangParse
	-lclangRewrite
	-lclangRewriteFrontend
	-lclangSema
	-lclangSerialization
	-lclangTooling
	-Wl,--end-group ;
LLVM_LIBS = bitreader mcparser transformutils option ;

LINKLIBS on citrun-inst += $(CLANG_LIBS) ;
LINKLIBS on citrun-inst += `llvm-config --libs $(LLVM_LIBS) --system-libs` ;

Main citrun-inst : $(INST_SRCS) ;
InstallBin $(PREFIX)/share/citrun : citrun-inst ;

#
# citrun-inst symlinks
#
InstLink cc : citrun-inst ;
InstLink gcc : citrun-inst ;
InstLink clang : citrun-inst ;
InstLink clang++ : citrun-inst ;
InstLink g++ : citrun-inst ;
InstLink c++ : citrun-inst ;
InstLink egcc : citrun-inst ;
InstLink eg++ : citrun-inst ;

CP = cp -PR ;
FILEMODE = 755 ;
InstallFile $(PREFIX)/share/citrun : cc gcc clang clang++ g++ c++ egcc eg++ ;

SubInclude TOP src glyphy ;
